(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8551:function(e,t,n){Promise.resolve().then(n.bind(n,9745))},9745:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eC}});var r=n(6778),o=n(9882),a=n(1289),i=n(5942),s=n(2183),c=n(8018),l=n(2581),d=n(9421),u=n(2391),p=function(e){let{permissions:t,showDirectories:n,setShowDirectories:a}=e;return(0,r.jsxs)(o.Z,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2,flexDirection:"row-reverse",my:1,children:[t&&(0,r.jsxs)(o.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,r.jsx)(c.Z,{variant:"body2",children:"Permissions:"}),t.map(e=>(0,r.jsx)(l.Z,{label:e,size:"small"},e))]}),(0,r.jsx)(d.Z,{control:(0,r.jsx)(u.Z,{checked:n,onChange:e=>a(e.target.checked),name:"show-directories",color:"primary",size:"small"}),label:"Show Directories",slotProps:{typography:{variant:"body2"}}})]})},h=n(4745),f=n(6509),g=n(240),m=n(9789),x=function(e){let{objectUrl:t,setObjectUrl:n,onChange:a,loading:i}=e,c=(0,s.Sf)(a,300);return(0,r.jsxs)(o.Z,{display:"flex",flexDirection:"column",children:[(0,r.jsx)(o.Z,{display:"flex",alignItems:"center",children:(0,r.jsx)(f.Z,{fullWidth:!0,onChange:e=>{n(e.target.value),c(e.target.value)},value:t,id:"pelican-url",placeholder:"Enter Pelican URL ( pelican://<federation>/<namespace>/* )",variant:"outlined",size:"medium",slotProps:{input:{startAdornment:(0,r.jsx)(g.Z,{position:"start",children:(0,r.jsx)(h.Z,{})})}}})}),i&&(0,r.jsx)(m.Z,{})]})},w=n(5473),v=n(8867),j=n(9309),y=n(9612),b=n(5405),k=n(4889),Z=n(8211),C=n(4412),E=n(8174);async function S(e){let t=await fetch("".concat(e,"/.well-known/openid-configuration"));if(200===t.status)return await t.json();throw Error("Issuer endpoint returned ".concat(t.status,": ").concat(e,"/.well-known/openid-configuration"))}let P=async e=>{let t="https://".concat(e,"/.well-known/pelican-configuration"),n=await fetch(t);if(200!==n.status)throw Error("Metadata endpoint returned ".concat(n.status,": ")+t);return{hostname:e,configuration:await n.json(),namespaces:{}}};var D=function(e){let t=e.match(/pelican:\/\/([^\/]+).*/),n=e.match(/pelican:\/\/[^\/]+(.*)/),r=e.match(/pelican:\/\/(.*)\/(.*)/);if(null===t||2!=t.length||null===n||2!=n.length||null===r||3!=r.length)throw Error("Invalid pelican object url: ".concat(e));return{federationHostname:t[1],objectPath:n[1],objectPrefix:r[1]}},_=function(e){e.blob().then(t=>{var n,r,o,a;let i=window.URL.createObjectURL(t);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"object",t=arguments.length>1?arguments[1]:void 0,n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",e),n.setAttribute("target","_blank"),n.style.display="none",n.click()}(null===(a=null===(o=null===(r=null===(n=e.url)||void 0===n?void 0:n.split("/"))||void 0===r?void 0:r.at(-1))||void 0===o?void 0:o.split("?"))||void 0===a?void 0:a.at(0),i)})},I=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";let n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(t<0?0:t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]},T=function(e){if(null!==e&&""!==e.trim()){if(!e.includes("=")){console.warn("Header not in expected format: ".concat(e,"\n	key=value[, key=value...]]"));return}return e.split(",").reduce((e,t)=>{let[n,r]=t.split("=").map(e=>e.trim());return e[n]=r,e},{})}},z=function(e){let t;if(!e||"string"!=typeof e)return[];try{t=new(window.DOMParser||n(7643).a)().parseFromString(e,"application/xml")}catch(e){return[]}return Array.from(t.getElementsByTagName("D:response")).map(e=>{let t=t=>{let n=e.getElementsByTagName(t)[0];return n&&n.textContent||""},n=t("D:href"),r=Number(t("lp1:getcontentlength")),o=t("lp1:getlastmodified"),a=e.getElementsByTagName("lp1:resourcetype")[0],i="";return a&&a.getElementsByTagName("D:collection").length>0&&(i="collection"),{href:n,getcontentlength:r,getlastmodified:o,resourcetype:i,iscollection:"1"===t("lp1:iscollection"),executable:t("lp1:executable"),status:t("D:status")}})},L=function(e){let t=e.searchParams.get("state");return null===t||""===t.trim()?{}:t.split(";").reduce((e,t)=>{let[n,r]=t.split(":");return e[n]=r,e},{})};async function U(e,t){let n=new URL("".concat(t.configuration.director_endpoint).concat(e));n.searchParams.append("redirect","false");let r=await fetch(n,{method:"HEAD"});if(200===r.status)return A(r);throw Error("Director endpoint returned ${response.status}: ${httpEndpoint}")}let A=e=>{try{let{issuer:t}=T(e.headers.get("X-Pelican-Authorization")),{namespace:n,requireToken:r,collectionUrl:o}=T(e.headers.get("X-Pelican-Namespace")),{issuer:a,maxScopeDepth:i,strategy:s,basePath:c}=T(e.headers.get("X-Pelican-Token-Generation"));return{issuer:t,namespace:{namespace:n,requireToken:"true"===r,collectionUrl:o},tokenGeneration:{issuer:a,maxScopeDepth:parseInt(i),strategy:s,basePath:c}}}catch(t){throw Error("Director endpoint did not return expected headers: ".concat(e.headers))}},R=async e=>{if(!function(e){if(void 0===e.token)return!0;let t=Math.floor(Date.now()/1e3);return e.token.exp<=t}(e))return e.token};async function O(e){return function(e){let t="",n=new Uint8Array(e),r=n.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(n[e]);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(await B(e))}async function B(e){let t=new TextEncoder().encode(e);return window.crypto.subtle.digest("SHA-256",t)}function N(e){return("0"+e.toString(16)).substr(-2)}var F=function(){let e=new Uint32Array(28);return(0,window.crypto).getRandomValues(e),Array.from(e,N).join("")},H=function(){let e=new URL(window.location.href),t=e.searchParams.get("code")||e.searchParams.get("CODE"),{federation:n,namespace:r}=L(new URL(window.location.href));return window.history.replaceState({},document.title,window.location.pathname),{federationHostname:n,namespacePrefix:r,code:t}};async function M(e,t,n,r,o){if(!e.token_endpoint)throw Error("OIDC configuration is missing token endpoint.");let a=new URLSearchParams;a.append("grant_type","authorization_code"),a.append("code",o),a.append("redirect_uri",window.location.href),a.append("code_verifier",t),a.append("client_id",n),a.append("client_secret",r);let i=await fetch(e.token_endpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});if(!i.ok)throw Error("Failed to get token: ".concat(i.statusText,". Response: ").concat(await i.text()));let{access_token:s,refresh_token:c,expires_in:l}=await i.json();return{accessToken:{value:s,...function(e){let t=e.split(".");if(3!==t.length)throw Error("Invalid JWT token");let n=t[1].replace(/-/g,"+").replace(/_/g,"/"),r=n.length%4,o=r?n+"=".repeat(4-r):n;try{let e=atob(o);return JSON.parse(e)}catch(e){throw Error("Invalid JWT payload: "+e)}}(s)},refreshToken:c,expiration:new Date(Date.now()+1e3*l).getTime()}}async function q(e,t){if("string"!=typeof e)throw Error("No registration endpoint provided for dynamic client registration.");let n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(201===n.status){let{client_id:e,client_secret:t}=await n.json();return{clientId:e,clientSecret:t}}throw Error("Was not able to register client at "+e)}let W=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!t.clientId||!t.oidcConfiguration.authorization_endpoint)throw Error("Namespace is missing required OIDC configuration for authorization code flow.");let o=await O(e),a=new URL(t.oidcConfiguration.authorization_endpoint),i=["namespace:".concat(t.prefix),"federation:".concat(n.hostname),...Object.entries(r).map(e=>{let[t,n]=e;return"".concat(t,":").concat(n)})].join(";");a.searchParams.append("client_id",t.clientId),a.searchParams.append("response_type","code"),a.searchParams.append("scope","storage.read:/ storage.create:/ storage.modify:/"),a.searchParams.append("redirect_uri",window.location.href),a.searchParams.append("code_challenge",o),a.searchParams.append("code_challenge_method","S256"),a.searchParams.append("state",i),a.searchParams.append("action",""),window.location.href=a.toString()},J=async e=>{if(void 0===e.registration_endpoint)return console.log("No registration endpoint found in issuer configuration:",e.issuer),null;let t={redirect_uris:[window.location.href],token_endpoint_auth_method:"client_secret_basic",grant_types:["refresh_token","authorization_code"],response_types:["code"],client_name:"Pelican Web Client",scope:"openid storage.create:/ storage.modify:/ storage.read:/"};return await q(e.registration_endpoint,t)},X=async(e,t)=>{let n=await U(e,t),r=await S(n.issuer),o=await J(r);return{prefix:n.namespace.namespace,token:void 0,clientId:null==o?void 0:o.clientId,clientSecret:null==o?void 0:o.clientSecret,oidcConfiguration:r}};class G extends Error{constructor(e){super(e),this.name=this.constructor.name}}let $=async(e,t,n)=>{let{objectPath:r}=D(e),o=await R(n),a=new URL("".concat(t.configuration.director_endpoint).concat(r)),i=await fetch(a,{headers:{Authorization:"Bearer ".concat(null==o?void 0:o.value)}});if(200===i.status)return i;if(403!==i.status||o){if(403===i.status)throw new ee("Provided token does not have access to the object");throw Error("Could not get object: ".concat(i.status," ").concat(i.statusText))}throw new G("Access token required to access the object")},V=async(e,t,n,r)=>{let{objectPath:o}=D(e),a=await R(r),i=new URL("".concat(n.configuration.director_endpoint).concat(o)),s=await fetch(i,{method:"PUT",headers:{Authorization:"Bearer ".concat(null==a?void 0:a.value)},body:t});if(200===s.status)return s;if(403!==s.status||a){if(403===s.status)throw new ee("Provided token does not have access to the object");throw Error("Could not get object: ".concat(s.status," ").concat(s.statusText))}throw new G("Access token required to access the object")},K=async(e,t,n)=>{let{objectPath:r}=D(e),o=n?await R(n):null,a=new URL("".concat(t.configuration.director_endpoint).concat(r)),i=await fetch(a,{method:"PROPFIND",headers:{Authorization:"Bearer ".concat(null==o?void 0:o.value),Depth:"1"}});if(200===i.status||207===i.status)return z(await i.text());if(403!==i.status||o){if(403===i.status)throw new ee("Provided token does not have access to the object");throw Error("Could not get object: ".concat(i.status," ").concat(i.statusText))}throw new G("Access token required to access the object")},Y=async(e,t)=>{let{federationHostname:n,objectPrefix:r}=D(e),o=await R(t),a=e.replace("pelican://".concat(n,"/").concat(t.prefix),"");return o?o.value.split(" ").filter(e=>e.startsWith("storage.")).reduce((e,t)=>{let[n,r]=t.split(":");return a.startsWith(r)?[...e,n]:e},[]):[]};class Q extends Error{constructor(e){super(e),this.name=this.constructor.name}}var ee=Q,et=e=>{let{disabled:t=!1,onUpload:n,currentPath:a,refs:s}=e,[l,d]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[h,f]=(0,i.useState)([]),g=(0,i.useRef)(0),m=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),g.current++,e.dataTransfer.items&&e.dataTransfer.items.length>0&&p(!0)},[]),x=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),g.current--,0===g.current&&p(!1)},[]),S=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),P=(0,i.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),p(!1),g.current=0,t||!n)return;let r=Array.from(e.dataTransfer.files);r.length>0&&(f(r.map(e=>({file:e,status:"pending"}))),d(!0),r.forEach(async(e,t)=>{f(e=>{let n=[...e];return n[t].status="uploading",n});try{await n(e),f(e=>{let n=[...e];return n[t].status="success",n})}catch(e){f(n=>{let r=[...n];return r[t].status="error",r[t].error=e instanceof Error?e.message:"Upload failed",r})}}))},[t,n]);return(0,i.useImperativeHandle)(s,()=>({dragHandlers:{onDragEnter:m,onDragOver:S,onDragLeave:x,onDrop:P}}),[m,S,x,P]),(0,i.useEffect)(()=>{if(0===h.length)return;let e=h.every(e=>"success"===e.status||"error"===e.status),t=h.some(e=>"error"===e.status);if(e&&!t){let e=setTimeout(()=>{d(!1),f([])},1500);return()=>clearTimeout(e)}if(e&&t){let e=setTimeout(()=>{d(!1),f([])},5e3);return()=>clearTimeout(e)}},[h]),(0,r.jsxs)(r.Fragment,{children:[u&&!t&&(0,r.jsx)(b.Z,{elevation:8,sx:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,backgroundColor:"rgba(25, 118, 210, 0.1)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",border:"4px dashed",borderColor:"primary.main",pointerEvents:"none"},children:(0,r.jsxs)(o.Z,{textAlign:"center",children:[(0,r.jsx)(v.Z,{sx:{fontSize:80,color:"primary.main",mb:2}}),(0,r.jsx)(c.Z,{variant:"h4",color:"primary",children:"Drop files to upload"}),a&&(0,r.jsxs)(c.Z,{variant:"body1",color:"text.secondary",sx:{mt:1},children:["to ",a]})]})}),l&&h.length>0&&(0,r.jsx)(b.Z,{elevation:8,sx:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,backgroundColor:"rgba(25, 118, 210, 0.1)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"auto"},children:(0,r.jsxs)(b.Z,{elevation:4,sx:{maxWidth:600,width:"90%",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,r.jsxs)(o.Z,{sx:{p:3,borderBottom:1,borderColor:"divider"},children:[(0,r.jsx)(c.Z,{variant:"h5",component:"h2",children:"Uploading Files"}),a&&(0,r.jsxs)(c.Z,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["to ",a]})]}),(0,r.jsx)(k.Z,{sx:{flex:1,overflow:"auto",p:0},children:h.map((e,t)=>(0,r.jsxs)(Z.ZP,{sx:{borderBottom:t<h.length-1?1:0,borderColor:"divider"},children:[(0,r.jsx)(C.Z,{children:"success"===e.status?(0,r.jsx)(w.Z,{color:"success"}):"error"===e.status?(0,r.jsx)(j.Z,{color:"error"}):(0,r.jsx)(y.Z,{color:"action"})}),(0,r.jsx)(E.Z,{primary:e.file.name,secondary:(0,r.jsxs)(o.Z,{sx:{width:"100%"},children:[(0,r.jsxs)(o.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[(0,r.jsx)(c.Z,{variant:"caption",component:"span",children:I(e.file.size)}),"success"===e.status&&(0,r.jsx)(c.Z,{variant:"caption",component:"span",color:"success.main",children:"Complete"})]}),"error"===e.status&&e.error&&(0,r.jsx)(c.Z,{variant:"caption",color:"error",component:"div",children:e.error})]})})]},t))})]})})]})},en=n(7226),er=n(4280),eo=n(2898),ea=n(7815),ei=n(8747),es=n(3134),ec=n(9045),el=n(6945),ed=n(8140),eu=n(6112),ep=n(5901),eh=n(5390);function ef(e){return(0,r.jsxs)(o.Z,{display:"flex",alignItems:"center",gap:1,children:[e.iscollection?""===e.getlastmodified?(0,r.jsx)(eo.Z,{color:"primary",fontSize:"small"}):(0,r.jsx)(ea.Z,{color:"primary",fontSize:"small"}):(0,r.jsx)(y.Z,{color:"action",fontSize:"small"}),e.iscollection&&""===e.getlastmodified?"..":e.href]})}var eg=function(e){let{objectList:t,showCollections:n=!0,onExplore:a,onDownload:s,loginRequired:l,canLogin:d,onLoginRequest:u}=e,[p,h]=(0,i.useState)("href"),[f,g]=(0,i.useState)("asc"),m=e=>{p===e?g("asc"===f?"desc":"asc"):(h(e),g("asc"))},x=e=>{e.iscollection?a(e.href):s(e.href)},w=(0,i.useMemo)(()=>[...t].filter(e=>n||!e.iscollection).sort((e,t)=>{let n,r;if(e.iscollection&&!t.iscollection)return -1;if(!e.iscollection&&t.iscollection)return 1;switch(p){case"href":n=e.href.toLowerCase(),r=t.href.toLowerCase();break;case"getcontentlength":n=e.getcontentlength,r=t.getcontentlength;break;case"getlastmodified":n=new Date(e.getlastmodified).getTime(),r=new Date(t.getlastmodified).getTime();break;default:return 0}return n<r?"asc"===f?-1:1:n>r?"asc"===f?1:-1:0}),[t,n,p,f]);return(0,r.jsx)(o.Z,{pt:2,children:l||!t||0===t.length?(0,r.jsx)(o.Z,{pt:4,display:"flex",alignItems:"center",justifyContent:"center",minHeight:300,children:(0,r.jsx)(c.Z,{variant:"h6",color:"textSecondary",align:"center",children:l?(0,r.jsxs)(r.Fragment,{children:["Authentication is required to view this collection.",(0,r.jsx)("br",{}),l&&d&&(0,r.jsx)(ei.Z,{variant:"contained",color:"primary",onClick:u,sx:{mt:2},children:"Login"})]}):(0,r.jsxs)(r.Fragment,{children:["Enter Pelican Collection URL to View Contents:",(0,r.jsx)("br",{}),(0,r.jsx)("strong",{children:"pelican://<federation>/<namespace>/<collection>/"})]})})}):(0,r.jsx)(es.Z,{component:b.Z,variant:"outlined",children:(0,r.jsxs)(ec.Z,{children:[(0,r.jsx)(el.Z,{children:(0,r.jsxs)(ed.Z,{children:[(0,r.jsx)(eu.Z,{children:(0,r.jsx)(ep.Z,{active:"href"===p,direction:"href"===p?f:"asc",onClick:()=>m("href"),children:"Name"})}),(0,r.jsx)(eu.Z,{children:(0,r.jsx)(ep.Z,{active:"getcontentlength"===p,direction:"getcontentlength"===p?f:"asc",onClick:()=>m("getcontentlength"),children:"Size"})}),(0,r.jsx)(eu.Z,{children:(0,r.jsx)(ep.Z,{active:"getlastmodified"===p,direction:"getlastmodified"===p?f:"asc",onClick:()=>m("getlastmodified"),children:"Updated"})}),(0,r.jsx)(eu.Z,{children:"Action"})]})}),(0,r.jsx)(eh.Z,{children:w.map((e,t)=>(0,r.jsxs)(ed.Z,{hover:!0,onClick:()=>x(e),style:{cursor:"pointer"},children:[(0,r.jsx)(eu.Z,{sx:{px:2,py:1},children:(0,r.jsx)(ef,{...e})}),(0,r.jsx)(eu.Z,{sx:{px:2,py:1},children:e.iscollection?"":I(e.getcontentlength)}),(0,r.jsx)(eu.Z,{sx:{px:2,py:1},children:e.getlastmodified}),(0,r.jsx)(eu.Z,{sx:{px:2,py:1},children:e.iscollection?(0,r.jsxs)("button",{onClick:t=>{t.stopPropagation(),a(e.href)},"aria-label":"Explore ".concat(e.href),style:{background:"transparent",border:"none",color:"var(--mui-palette-text-primary, #000)",padding:0,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:6,fontSize:"0.95rem"},children:[(0,r.jsx)(en.Z,{fontSize:"small"}),(0,r.jsx)("span",{style:{opacity:.85},children:"Explore"})]}):(0,r.jsxs)("button",{onClick:t=>{t.stopPropagation(),s(e.href)},"aria-label":"Download ".concat(e.href),style:{background:"transparent",border:"none",color:"var(--mui-palette-text-primary, #000)",padding:0,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:6,fontSize:"0.95rem"},children:[(0,r.jsx)(er.Z,{fontSize:"small"}),(0,r.jsx)("span",{style:{opacity:.85},children:"Download"})]})})]},t))})]})})})};let em=i.useLayoutEffect;function ex(e){let t=(0,i.useRef)(()=>{throw Error("Cannot call an event handler while rendering.")});return em(()=>{t.current=e},[e]),(0,i.useCallback)(function(){for(var e,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return null===(e=t.current)||void 0===e?void 0:e.call(t,...r)},[t])}function ew(e,t,n,r){let o=(0,i.useRef)(t);em(()=>{o.current=t},[t]),(0,i.useEffect)(()=>{var t;let a=null!==(t=null==n?void 0:n.current)&&void 0!==t?t:window;if(!(a&&a.addEventListener))return;let i=e=>{o.current(e)};return a.addEventListener(e,i,r),()=>{a.removeEventListener(e,i,r)}},[e,n,r])}function ev(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{initializeWithValue:r=!0}=n,o=(0,i.useCallback)(e=>n.serializer?n.serializer(e):JSON.stringify(e),[n]),a=(0,i.useCallback)(e=>{let r;if(n.deserializer)return n.deserializer(e);if("undefined"===e)return;let o=t instanceof Function?t():t;try{r=JSON.parse(e)}catch(e){return console.error("Error parsing JSON:",e),o}return r},[n,t]),s=(0,i.useCallback)(()=>{let n=t instanceof Function?t():t;try{let t=window.sessionStorage.getItem(e);return t?a(t):n}catch(t){return console.warn("Error reading sessionStorage key “".concat(e,"”:"),t),n}},[t,e,a]),[c,l]=(0,i.useState)(()=>r?s():t instanceof Function?t():t),d=ex(t=>{try{let n=t instanceof Function?t(s()):t;window.sessionStorage.setItem(e,o(n)),l(n),window.dispatchEvent(new StorageEvent("session-storage",{key:e}))}catch(t){console.warn("Error setting sessionStorage key “".concat(e,"”:"),t)}}),u=ex(()=>{let n=t instanceof Function?t():t;window.sessionStorage.removeItem(e),l(n),window.dispatchEvent(new StorageEvent("session-storage",{key:e}))});(0,i.useEffect)(()=>{l(s())},[e]);let p=(0,i.useCallback)(t=>{t.key&&t.key!==e||l(s())},[e,s]);return ew("storage",p),ew("session-storage",p),[c,d,u]}var ej=function(e){let{objectUrl:t,setObjectUrl:n,enableAuth:r=!0}=e,[o,a]=ev("pelican-wc-federations",{}),[s,c]=ev("pelican-wc-p2n",{}),[l,d]=ev("pelican-wc-cv",null),[u,p]=(0,i.useState)(null),[h,f]=(0,i.useState)([]),[g,m]=(0,i.useState)(!1),[x,w]=(0,i.useState)(!0),[v,j]=(0,i.useState)(!1),[y,b]=(0,i.useState)(!1),[k,Z]=(0,i.useState)(!1),{federationHostname:C,objectPrefix:E}=(0,i.useMemo)(()=>{try{return D(t)}catch(e){return{federationHostname:"",objectPrefix:"",objectPath:""}}},[t]);(0,i.useEffect)(()=>{var e;if(!r){b(!0);return}let{federationHostname:t,namespacePrefix:n,code:i}=H();if(!i||!t||!n||!l)return;let s=null===(e=o[t])||void 0===e?void 0:e.namespaces[n];if(!(null==s?void 0:s.clientId)||!(null==s?void 0:s.clientSecret)){console.error("Cannot exchange code: missing client credentials for namespace",n),b(!0);return}M(s.oidcConfiguration,l,s.clientId,s.clientSecret,i).then(e=>{a(r=>{var o,a,i;return{...r,[t]:{...r[t],namespaces:{...null===(o=r[t])||void 0===o?void 0:o.namespaces,[n]:{...null===(i=r[t])||void 0===i?void 0:null===(a=i.namespaces)||void 0===a?void 0:a[n],token:e.accessToken}}}}})}).catch(e=>{console.error("Error during authorization code exchange:",e)}).finally(()=>{b(!0)})},[r,l,o,a]),(0,i.useEffect)(()=>{r||j(!1)},[r]),(0,i.useEffect)(()=>{l||d(F())},[l]);let S=(0,i.useCallback)(async e=>{var t,n;let r,i,l;console.log(o);try{let t=D(e);r=t.federationHostname,i=t.objectPrefix,l=t.objectPath}catch(e){return j(!1),p([]),f([]),!1}let d=o;if(!(r in d))try{let e=await P(r);d={...d,[r]:e},a(d)}catch(e){}let u=d[r];if(!u)throw Error("Federation not found (which should be impossible due to prior fetch).");let h=s;if(!(i in h))try{let e=await X(l,u);h={...h,[i]:{federation:r,namespace:e.prefix}},c(h),e.prefix in d[r].namespaces||(d={...d,[r]:{...d[r],namespaces:{...d[r].namespaces,[e.prefix]:e}}},a(d))}catch(e){console.log("Failed to fetch namespace for prefix:",i,e)}let g=null===(n=d[r].namespaces)||void 0===n?void 0:n[null===(t=h[i])||void 0===t?void 0:t.namespace];if(!g)return!1;try{let e=[];j(!1);try{e=await K("pelican://".concat(i),u,g)}catch(t){e=await K("pelican://".concat(r).concat(l),u,g)}let t=l.split("/").filter(e=>e.length>0);if(t.length>0){let n=t.slice(0,-1),r=n.length>0?"/"+n.join("/"):"";e.push({href:r||"/",getcontentlength:0,getlastmodified:"",resourcetype:"collection",iscollection:!0,executable:"",status:""})}f(e.reverse())}catch(e){e instanceof G&&(j(!0),f([]))}try{let t=await Y(e,g);p(t)}catch(e){}return!0},[o,s,a,c]),I=(0,i.useCallback)(async e=>{m(!0),n(e);let t=await S(e);return m(!1),t},[S]);(0,i.useEffect)(()=>{y&&!k&&(Z(!0),I(t))},[y,k,t,t,o,I]);let T=(0,i.useCallback)(e=>{I("pelican://".concat(C).concat(e,"/"))},[C,I]),z=(0,i.useCallback)(async e=>{try{var t,n;let r=await $("pelican://".concat(C).concat(e),o[C],null===(n=o[C].namespaces)||void 0===n?void 0:n[null===(t=s[E])||void 0===t?void 0:t.namespace]);_(r)}catch(e){console.error("Download failed:",e)}},[C,o,s,E]),L=(0,i.useCallback)(async()=>{if(r&&l)try{let e=o[C],n=s[E],r=e.namespaces[n.namespace];W(l,r,e,{objectUrl:t})}catch(e){console.error("Login failed:",e)}},[r,l,o,s,C,E]),U=(0,i.useCallback)(async e=>{var n,r;let a=o[C],i=null===(r=a.namespaces)||void 0===r?void 0:r[null===(n=s[E])||void 0===n?void 0:n.namespace],c=t.endsWith("/")?"".concat(t).concat(e.name):"".concat(t,"/").concat(e.name);await V(c,e,a,i),I(t)},[C,E,t,o,s,I]);return{objectUrl:t,setObjectUrl:n,federations:o,setFederations:a,prefixToNamespace:s,setPrefixToNamespace:c,permissions:u,setPermissions:p,objectList:h,loading:g,showDirectories:x,setShowDirectories:w,loginRequired:v,handleRefetchObject:I,handleLogin:L,handleExplore:T,handleDownload:z,handleUpload:U}},ey=function(e){var t,n;let a=(0,i.useRef)(null),{objectUrl:s,setObjectUrl:c,objectList:l,loading:d,showDirectories:u,permissions:h,setShowDirectories:f,loginRequired:g,handleLogin:m,handleRefetchObject:w,handleExplore:v,handleDownload:j,handleUpload:y}=ej(e);return(0,r.jsxs)(o.Z,{...null!==(n=null===(t=a.current)||void 0===t?void 0:t.dragHandlers)&&void 0!==n?n:{},children:[(0,r.jsxs)(o.Z,{mt:6,mx:"auto",width:"100%",display:"flex",flexDirection:"column",children:[(0,r.jsxs)(o.Z,{pt:2,children:[(0,r.jsx)(x,{objectUrl:s,setObjectUrl:c,onChange:w,loading:d}),(0,r.jsx)(p,{permissions:h,showDirectories:u,setShowDirectories:f})]}),!g&&(0,r.jsx)(o.Z,{pt:2,children:(0,r.jsx)(et,{refs:a,disabled:!1,onUpload:y,currentPath:s})})]}),(0,r.jsx)(eg,{objectList:l,showCollections:u,onExplore:v,onDownload:j,loginRequired:g,onLoginRequest:m,canLogin:!0}),(0,r.jsx)(o.Z,{mt:4,component:"pre"})]})},eb=function(e){let{objectUrl:t,setObjectUrl:n,objectList:a,loading:i,showDirectories:s,setShowDirectories:c,loginRequired:l,handleRefetchObject:d,handleExplore:u,handleDownload:h}=ej(e);return(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(o.Z,{mt:6,mx:"auto",width:"100%",display:"flex",flexDirection:"column",children:(0,r.jsxs)(o.Z,{pt:2,children:[(0,r.jsx)(x,{objectUrl:t,setObjectUrl:n,onChange:d,loading:i}),(0,r.jsx)(p,{permissions:null,showDirectories:s,setShowDirectories:c})]})}),(0,r.jsx)(eg,{objectList:a,showCollections:s,onExplore:u,onDownload:h,loginRequired:l,canLogin:!1})]})},ek=e=>{let{enableAuth:t,...n}=e;return t?(0,r.jsx)(ey,{...n}):(0,r.jsx)(eb,{...n})};function eZ(){let e=(0,a.useSearchParams)(),t=(0,i.useMemo)(()=>{var t,n;return null!==(t=(null===(n=e.get("state"))?{}:n.split(";").reduce((e,t)=>{let n=t.indexOf(":");if(-1===n)return e;let r=t.substring(0,n),o=t.substring(n+1);return e[r]=o,e},{})).objectUrl)&&void 0!==t?t:"pelican://osg-htc.org/ncar"},[]),[n,c]=(0,i.useState)(!1),[l,d]=(0,s.Xs)("pelican-object-url",t);return(0,r.jsx)(o.Z,{minHeight:"90vh",margin:4,width:"1200px",mx:"auto",children:(0,r.jsxs)(o.Z,{minHeight:"90vh",margin:4,width:"1200px",mx:"auto",children:[(0,r.jsx)(o.Z,{display:"flex",justifyContent:"flex-end",mb:2,alignItems:"center",children:(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsx)("input",{type:"checkbox",checked:n,onChange:()=>c(e=>!e),"aria-label":"Toggle read-write"}),(0,r.jsx)("span",{children:"Read-only Mode"})]})}),(0,r.jsx)(ek,{objectUrl:l,setObjectUrl:d,enableAuth:!n})]})})}var eC=function(){return(0,r.jsx)(i.Suspense,{fallback:(0,r.jsx)("div",{children:"Loading..."}),children:(0,r.jsx)(eZ,{})})}}},function(e){e.O(0,[507,19,43,195,744],function(){return e(e.s=8551)}),_N_E=e.O()}]);